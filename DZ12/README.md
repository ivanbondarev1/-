# **Лабораторная работа. "Настройка NAT для IPv4"**
## **Топология** 
![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/Топлогия.png?raw=true)

## **Цели:**

+ ### Часть 1. Создание сети и настройка основных параметров устройства.
+ ### Часть 2. Настройка и проверка NAT для IPv4.
+ ### Часть 3. Настройка и проверка PAT для IPv4.
+ ### Часть 4. Настройка и проверка статического NAT для IPv4.


## **Решение**
## **Часть 1. Создание сети и настройка основных параметров устройства**

### **Шаг 1. Подключите кабели сети согласно приведенной топологии.**
### **Шаг 2. Произведите базовую настройку маршрутизаторов.**

### R1:

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(ст).png?raw=true)



### R2:

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R2(ст).png?raw=true)

*#ip route 0.0.0.0 0.0.0.0 192.168.1.1

### **Шаг 3. Настройте базовые параметры каждого коммутатора.**

### S1:

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/S1(ст).png?raw=true)

*S1(config)#int vlan 1

*S1(config-if)#ip addr 192.168.1.11 255.255.255.0

### S2:

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/S2(ст).png?raw=true)


*S2(config)#int vlan 1;


*S2(config-if)#ip addr 192.168.1.12 255.255.255.0

## **Часть 2. Настройка и проверка NAT для IPv4.**

### **Шаг 1. Настройте NAT на R1, используя пул из трех адресов 209.165.200.226-209.165.200.228.**


**a**.	Настройте простой список доступа, который определяет, какие хосты будут разрешены для трансляции. В этом случае все устройства в локальной сети R1 имеют право на трансляцию.
**R1(config)# access-list 1 permit 192.168.1.0 0.0.0.255**


**b**.	Создайте пул NAT и укажите ему имя и диапазон используемых адресов.
**R1(config)# ip nat pool PUBLIC_ACCESS 209.165.200.226 209.165.200.228 netmask 255.255.255.248** 

**c**.	Настройте перевод, связывая ACL и пул с процессом преобразования.
**R1(config)# ip nat inside source list 1 pool PUBLIC_ACCESS** 


**d**.	Задайте внутренний (inside) интерфейс. 
**R1(config)# interface g0/0/1**
**R1(config-if)# ip nat inside**

**e**.	Определите внешний (outside) интерфейс.
**R1(config)# interface g0/0/0**
**R1(config-if)# ip nat outside**


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(nat).png?raw=true)



### **Шаг 2. Проверьте и проверьте конфигурацию.**

**a.**	С PC-B,  запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните процес поиска и устранения неполадок. На R1 отобразите таблицу NAT на R1 с помощью команды **#show ip nat translations**.

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(transl).png?raw=true)

### ***Вопросы:***

Во что был транслирован внутренний локальный адрес PC-B? **Ответ:** 209.165.200.226

Какой тип адреса NAT является переведенным адресом? **Ответ:** Внутренний глобальный


**b.**	С PC-A, запустите  эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды **#show ip nat translations.**

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1%20(2_trans).png?raw=true)


**c.** Обратите внимание, что предыдущая трансляция для PC-B все еще находится в таблице. Из S1, эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды **#show ip nat translations**.

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1%20(3_trans).png?raw=true)


**d.**	Теперь запускаем пинг R2 Lo1 из S2. На этот раз перевод завершается неудачей, и вы получаете эти сообщения (или аналогичные) на консоли R1:


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/S2(Err).png?raw=true)





**e.**	Это ожидаемый результат, потому что выделено только 3 адреса, и мы попытались ping Lo1 с четырех устройств. Напомним, что NAT — это трансляция «один-в-один». Как много выделено трансляций? Введите команду **#show ip nat translations verbose** , и вы увидите, что ответ будет 24 часа.


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(all_trans).png?raw=true)


**f.**	Учитывая, что пул ограничен тремя адресами, NAT для пула адресов недостаточно для нашего приложения. Очистите преобразование NAT и статистику, и мы перейдем к PAT.




## **Часть 3. Настройка и проверка PAT для IPv4.**


### **Шаг 1. Удалите команду преобразования на R1.**

### **Шаг 2. Добавьте команду PAT на R1.**

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(PAT_start).png?raw=true)


### **Шаг 3. Протестируйте и проверьте конфигурацию.**

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(PAT_trans).png?raw=true)


### ***Вопросы:***

Во что был транслирован внутренний локальный адрес PC-B? **Ответ:** 209.165.200.228
 
Какой тип адреса NAT является переведенным адресом? **Ответ:** Внутренний глобальный

Чем отличаются выходные данные команды show ip nat translations из упражнения NAT? **Ответ:** другой Внутренний глобальный адрес


 **b.**	С PC-A, запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды **#show ip nat translations**.


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(PC-A).png?raw=true)


**c.**	Генерирует трафик с нескольких устройств для наблюдения PAT. На PC-A и PC-B используйте параметр -t с командой ping, чтобы отправить безостановочный ping на интерфейс Lo1 R2 (**#ping -t 209.165.200.1**), затем вернитесь к R1 и выполните команду **#show ip nat translations**:


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/PAT(trans).png?raw=true)



**d.**	PAT в пул является очень эффективным решением для малых и средних организаций. Тем не менее есть неиспользуемые адреса IPv4, задействованные в этом сценарии. Мы перейдем к PAT с перегрузкой интерфейса, чтобы устранить эту трату IPv4 адресов. Остановите ping на PC-A и PC-B с помощью комбинации клавиш Control-C, затем очистите трансляции и статистику.



### **Шаг 4. На R1 удалите команды преобразования nat pool.**

### **Шаг 5. Добавьте команду PAT overload, указав внешний интерфейс.**


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(clear).png?raw=true)


### **Шаг 6. Протестируйте и проверьте конфигурацию.**


**a.**	Давайте проверим PAT, чтобы интерфейс работал. С PC-B,  запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды show **#ip nat translations**.

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/shag_6(a).png?raw=true)


**b.**	Сделайте трафик с нескольких устройств для наблюдения PAT. На PC-A и PC-B используйте параметр -t с командой ping для отправки безостановочного ping на интерфейс Lo1 R2 (**#ping -t 209.165.200.1**). На S1 и S2 выполните привилегированную команду exec ping 209.165.200.1 повторить 2000. Затем вернитесь к R1 и выполните команду **#show ip nat translations**.

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/shag_6(b).png?raw=true)


## **Часть 4. Настройка и проверка статического NAT для IPv4.**


### **Шаг 1. На R1 очистите текущие трансляции и статистику.**


### **Шаг 2. На R1 настройте команду NAT, необходимую для статического сопоставления внутреннего адреса с внешним адресом.**


### **Шаг 3. Протестируйте и проверьте конфигурацию.**


**a.**	Давайте проверим, что статический NAT работает. На R1 отобразите таблицу NAT на R1 с помощью команды **#show ip nat translations**, и вы увидите статическое сопоставление.

![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/NAT(static).png?raw=true)


**b.**	Таблица перевода показывает, что статическое преобразование действует. Проверьте это, запустив ping  с R2 на 209.165.200.229. Пинги должны работать.


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R2(ping).png?raw=true)


**c.**	На R1 отобразите таблицу NAT на R1 с помощью команды **#show ip nat translations**, и вы увидите статическое сопоставление и преобразование на уровне порта для входящих pings


![](https://github.com/ivanbondarev1/Otus/blob/main/DZ12/R1(R2-ping).png?raw=true)


























